<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="telephone=no,email=no" name="format-detection"/>
    <script src="../build/flexible_css.debug.js"></script>
    <script src="../build/flexible.debug.js"></script>
    <link rel="stylesheet" href="../css/mobile_da.css"/>
    <title>分答</title>
</head>
<body>
<div class="topTile">
    <a href="javascript:history.back()" class="return"></a>
    <p>我的听</p>
</div>

<div class="dalist">
    <ul id="myul">
        <!--<li>-->
        <!--<p class="pram">上证指数减肥税务局负责 等废弃物王妃王妃王妃务局负责 等废弃物王妃王妃王妃 务局负责 等废弃物王v妃王妃王妃 务局负责 等废</p>-->
        <!--<div class="personInfo">-->
        <!--<a href="#" class="img"><img src="../images/peo.png"/></a>-->
        <!--<div class="des">-->
        <!--<h3>唐老师</h3>-->
        <!--<p class="identity">巅峰财富|策略分析师</p>-->
        <!--<div class="status">-->
        <!--<span class="play"><i></i>点击播放</span> 14 ''-->
        <!--</div>-->
        <!--<p class="time">15分钟前</p>-->
        <!--</div>-->
        <!--</div>-->
        <!--</li>-->

        <!--<li>-->
        <!--<div class="personInfo">-->
        <!--<a href="#" class="img"><img src="../images/peo.png"/></a>-->
        <!--<div class="des">-->
        <!--<h3>唐老师</h3>-->
        <!--<p class="identity"><span class="state">待回答</span>巅峰财富|策略分析师</p>-->
        <!--<p class="pram">上证指数减肥税务局负责 等废弃物王妃王妃王妃务局负责 等废弃物王妃王妃王妃 务局负责 等废弃物王v妃王妃王妃 务局负责 等废</p>-->
        <!--<p class="time">15分钟前</p>-->
        <!--</div>-->
        <!--</div>-->
        <!--</li>-->

        <!--<li>-->
        <!--<div class="personInfo">-->
        <!--<a href="#" class="img"><img src="../images/peo.png"/></a>-->
        <!--<div class="des">-->
        <!--<h3>唐老师</h3>-->
        <!--<p class="identity"><span class="state overstate">已过期</span>巅峰财富|策略分析师</p>-->
        <!--<p class="pram">上证指数减肥税务局负责 等废弃物王妃王妃王妃务局负责 等废弃物王妃王妃王妃 务局负责 等废弃物王v妃王妃王妃 务局负责 等废</p>-->
        <!--<p class="time">15分钟前</p>-->
        <!--</div>-->
        <!--</div>-->
        <!--</li>-->

        <!--<li>-->
        <!--<p class="pram">上证指数减肥税务局负责 等废弃物王妃王妃王妃务局负责 等废弃物王妃王妃王妃 务局负责 等废弃物王v妃王妃王妃 务局负责 等废</p>-->
        <!--<div class="personInfo">-->
        <!--<a href="#" class="img"><img src="../images/peo.png"/></a>-->
        <!--<div class="des">-->
        <!--<h3>唐老师</h3>-->
        <!--<p class="identity">巅峰财富|策略分析师</p>-->
        <!--<div class="status">-->
        <!--<a href="javascript:;" class="vbtn viewbtn3">点击查看</a>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</li>-->
    </ul>
</div>

<!-- 查看信息 -->
<div class="fixbottomBox fixbottomInfo" style="display:none">
    <div class="bg"></div>
    <div class="cont">
        <span class="closed"></span>
        <div class="personInfo">
            <a href="#" class="img"><img src="images/peo.png" id="infohead"/></a>
            <div class="des">
                <h3 id="infoName">唐老师</h3>
                <p class="identity" id="infoTeam">巅峰财富|策略分析师</p>
                <div class="showpic"><img src="images/temp.jpg" id="infoimg"/></div>
                <p class="pram" id="infoContent">
                    尽管央行今日继续大额净投放，但似乎并不能足够缓解资金紧张。央行今日进行了1150亿元7天期、850亿元14天期逆回购操作、350亿元28天期逆回购操作。今天有600亿逆回购到期，还将有1660亿元6个月期中期借贷便利（MLF）到期。也就是说，央行公开市场今日净投放1750亿元。王v妃王妃
                </p>
            </div>
        </div>
    </div>
</div>
<!-- 登录 -->
<div class="fixbottomBox fixbottomLogin" style="display:none">
    <div class="bg"></div>
    <div class="cont">
        <span class="closed"></span>
        <div class="btn"><a href="#">登录</a> <a href="#">注册</a></div>
        <h4>第三方登录</h4>
        <div class="thirdLogin">
            <a href="#" class="a1"><span></span>微博</a>
            <a href="#" class="a2"><span></span>微信</a>
            <a href="#" class="a3"><span></span>QQ</a>
        </div>
    </div>
</div>

<!-- 支付 -->
<div class="fixbottomBox fixbottomPay" style="display:none">
    <div class="bg"></div>
    <div class="cont">
        <span class="closed"></span>
        <h4>使用u比支付</h4>
        <p>您将支付N枚U币用于旁听该问题回答，请确认支付。</p>
        <div class="btn"><a href="#" class="cfbtn">确认</a><a href="#">取消</a></div>
    </div>
</div>
<script src="../js/zepto.min.js"></script>
<script src="../js/all.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript">
    $(function () {
        $('.dalist').on('click', '.personInfo .info', function () {
            var answerId = this.id;
            $.ajax({
                type: 'POST',
                url: '/question/detail',
                data: {answerId: answerId},
                dataType: 'json',
                timeout: 1000,
                success: function (data) {
                    var json = data.data;
                    for (var i = 0; i < json.length; i++) {
                        $('#infoName').html(json[i].user_name);
                        $('#infoTeam').html(json[i].user_name);
                        $('#infoContent').html(json[i].content);
                        $('#infohead').attr("src", json[i].fileurl);
                        $('#infoimg').attr("src", json[i].fileurl);
                    }
                    //返回的数据为空的情况
                    //后台做验证
                    //此时可能是未付款，或者未登录
                    if (json.length == 0) {
                        //未登录
                        if (data.message == '未登录') {
                            animateshowHide($('.fixbottomLogin .bg'));
                        }
                        else if (data.message == '未付款') {
                            animateshowHide($('.fixbottomPay .bg'));
                        }
                    }
                    else {
                        animateshowHide($('.fixbottomInfo .bg'));
                    }
                },
                error: function (xhr, type) {
                    alert('Ajax error!')
                }
            });
            return false;
        });

        $('.dalist').on('click', '.personInfo .noPay', function () {
            animateshowHide($('.fixbottomPay .bg'));
            return false;
        });
        $('.dalist').on('click', '.personInfo .play', function () {
            alert('play');
            return false;
        });

        //请求数据，获得我听
        $.ajax({
            type: 'POST',
            url: '/user/listen',
            data: {},
            dataType: 'json',
            timeout: 2000,
            success: function (data) {
                var code = data.code;
                if (code == 0) {
                    var json = data.data;
                    var action = '';
                    for (var i = 0; i < json.length; i++) {
                        //问题状态，是否有权限听，多少钱能听
                        //是否登录 1，登录。0未登录
                        var tip = '';
                        var action = '';
                        //play： 已付钱可以播放
                        //info：已付钱可以查看
                        //out： 未登录
                        //noPay：未付钱

                        //是否已经付钱
                        // 1 已经付过钱了  0：还没付钱
                        if (json[i].payment == 1) {
                            //是文字还是录音
                            //type:0 图文 ，1：录音
                            if (json[i].type == 1) {
                                tip = '点击播放';
                                action = 'play';
                            }
                            else {
                                tip = '点击查看';
                                action = 'info';
                            }
                        }
                        //未付钱
                        else {
                            action = 'noPay';
                            if (json[i].type == 1) {
                                tip = json[i].listenprice + 'U币点击播放';
                            }
                            else {
                                tip = json[i].listenprice + 'U币点击查看';
                            }
                        }
                        var html = "";
                        if (action != 'play') {
                            html += '<li>';
                            html += '<span>';
                            //问题内容
                            html += '<p class="pram">' + json[i].questioncontent + '</p>';
                            html += '<div class="personInfo">';
                            //图片的点击效果
                            html += '<a href= "/apk/ask.html?id=' + json[i].ut + '" class="img"><img src=' + json[i].fileurl + '></a>';
                            html += '<div class="des">';
                            //用户名称
                            html += '<h3>' + json[i].user_name + '</h3>';
                            //时间   用户职位名称
                            html += '<p class="identity"><span><i></i>' + json[i].time + '</span>' + json[i].user_name + '</p>';
                            //问题状态，是否有权限听，多少钱能听
                            html += '<div class="status">';
                            html += '<a href="javascript:;" class="vbtn ' + action + ' " id = ' + json[i].id + '>' + tip + '</a>';
                            html += '</div>';
                            html += '<div class="act">';
                            //旁听数
                            html += '<a href="#" class="icon_hear"><i></i>' + '旁听' + json[i].listennum + '</a>';
                            html += '<a href="#" class="icon_share"><i></i>分享</a>';
                            html += '<a href="#" class="icon_fav" id="' + json[i].id + '" onclick="collect(' + json[i].id + ')" ><i></i>收藏</a>';
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            html += '</span>';
                            html += '</li>';
                        }
                        else {
                            html += '<li>';
                            html += '<span>';
                            html += '<p class="pram">' + '</p>';
                            html += '<div class="personInfo">';
                            html += '<a href="/apk/ask.html?id=' + json[i].ut + '" class="img"><img src="' + json[i].fileurl + '"/></a>';
                            html += '<div class="des">';
                            //姓名
                            html += '<h3>' + json[i].user_name + '</h3>';
                            //时间  职位
                            html += '<p class="identity"><span><i></i>' + json[i].time + '</span>' + json[i].user_name + '</p>';
                            html += '<div class="status">';
                            html += '<a href="javascript:;" class="vbtn play"><i></i>点击播放' + 14 + " ''" + '</a>';
                            html += '</div>';
                            html += '<div class="act">';
                            html += '<a href="#" class="icon_hear"><i></i>' + '旁听' + json[i].listennum + '</a>'
                            html += '<a href="#" class="icon_share"><i></i>分享</a>';
                            html += '<a href="#" class="icon_fav" id="' + json[i].id + '" onclick="collect(' + json[i].id + ')"><i></i>收藏</a>'
                            html += '</div>';
                            html += '</div>';
                            html += '</div>';
                            html += '</span>';
                            html += '</li>';
                        }
                        $("#myul").append(html);
                    }
                }
                else {
                    alert(data.message);
                }
            },
            error: function (xhr, type) {
                alert('Ajax error!')
            }
        })
    })
</script>
</body>
</html>
